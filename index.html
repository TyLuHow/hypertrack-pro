<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2c5f5f">
    <title>HyperTrack Pro</title>
    
    <!-- PWA Support -->
    <link rel="manifest" href="/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HyperTrack Pro">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icon-512.png">
    <link rel="apple-touch-icon" href="/icon-192.png">
    
    <!-- Critical CSS Inline - Fallback -->
    <style>
        /* Critical CSS for immediate rendering */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f8fafc;
            min-height: 100vh;
        }
        .app { min-height: 100vh; display: flex; flex-direction: column; }
        .header { 
            background: linear-gradient(135deg, #1b4e4e, #2c5f5f);
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header-content { text-align: center; flex: 1; }
        .app-title { font-size: 28px; font-weight: 800; margin-bottom: 4px; }
        .app-subtitle { font-size: 14px; opacity: 0.9; }
        .main-content { flex: 1; padding: 20px; max-width: 800px; margin: 0 auto; width: 100%; }
        .welcome-card { 
            text-align: center;
            background: linear-gradient(135deg, #2a2c2f, #334155);
            border: 1px solid #374151;
            border-radius: 16px;
            padding: 40px 24px;
            margin-bottom: 24px;
        }
        .btn { 
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 16px 32px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            min-height: 52px;
            background: linear-gradient(135deg, #1b4e4e, #2c5f5f);
            color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        .btn:hover { transform: translateY(-2px); }
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #2a2c2f;
            border-top: 1px solid #374151;
            display: flex;
            z-index: 100;
        }
        .nav-btn {
            flex: 1;
            padding: 12px 8px;
            background: none;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        .nav-btn.active { color: #3d7070; }
        .nav-icon { font-size: 24px; }
        .nav-label { font-size: 12px; font-weight: 600; }
        .tab-content { display: none; padding-bottom: 100px; }
        .tab-content.active { display: block; }
        .settings-btn {
            background: rgba(255,255,255,0.1);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
    </style>
    
    <!-- Main Styles - Cache busting -->
    <link rel="stylesheet" href="/styles.css?v=2.0.1">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>
    <!-- App Container -->
    <div class="app" id="app">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="app-title">HyperTrack Pro</h1>
                <p class="app-subtitle">Evidence-Based Hypertrophy Optimization</p>
            </div>
            <div class="header-actions">
                <button class="settings-btn" onclick="openSettings()" aria-label="Settings">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </button>
            </div>
        </header>

        <!-- Research Banner -->
        <div class="research-banner" id="researchBanner" style="background: #2a2c2f; border-bottom: 1px solid #374151; padding: 16px 20px;">
            <div class="research-content" style="display: flex; align-items: center; gap: 12px; max-width: 600px; margin: 0 auto;">
                <span class="research-icon" style="font-size: 20px; opacity: 0.8;">üî¨</span>
                <p class="research-text" id="researchText" style="font-size: 14px; color: #cbd5e1; margin: 0;">Loading research insights...</p>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Workout Tab -->
            <div id="workoutTab" class="tab-content active">
                <div class="workout-container">
                    <!-- Start Workout Section -->
                    <div id="startWorkout" class="start-workout">
                        <div class="welcome-card">
                            <h2 style="font-size: 24px; margin-bottom: 12px;">Ready to Train?</h2>
                            <p style="color: #cbd5e1; margin-bottom: 24px; font-size: 16px;">Start a new workout session to begin tracking your progress with evidence-based training principles.</p>
                            <button class="btn btn-primary btn-large" onclick="startWorkout()">
                                <span class="btn-icon" style="font-size: 18px;">üí™</span>
                                Start New Workout
                            </button>
                        </div>
                    </div>

                    <!-- Current Workout Display -->
                    <div id="currentWorkout" class="current-workout" style="display: none;">
                        <div class="workout-header">
                            <h2>Current Workout</h2>
                            <div class="workout-timer">
                                <span id="workoutTime">00:00</span>
                            </div>
                        </div>
                        <div id="currentExercises" class="current-exercises"></div>
                    </div>

                    <!-- Exercise Selection -->
                    <div id="exerciseSelection" class="exercise-selection" style="display: none;">
                        <div class="search-container" style="position: relative; margin-bottom: 20px;">
                            <input type="text" 
                                   class="search-input" 
                                   id="exerciseSearch" 
                                   placeholder="Search exercises..."
                                   onkeyup="filterExercises(this.value)"
                                   style="width: 100%; padding: 16px 20px 16px 50px; background: #334155; border: 1px solid #374151; border-radius: 12px; color: #f8fafc; font-size: 16px;">
                            <div class="search-icon" style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #94a3b8;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"></circle>
                                    <path d="m21 21-4.35-4.35"></path>
                                </svg>
                            </div>
                        </div>

                        <div class="muscle-groups" style="display: flex; gap: 8px; margin-bottom: 20px; overflow-x: auto;">
                            <button class="muscle-btn active" onclick="filterByMuscle('all')" style="padding: 8px 16px; background: #2c5f5f; color: white; border: 1px solid #2c5f5f; border-radius: 20px; font-size: 14px; cursor: pointer; white-space: nowrap;">All</button>
                            <button class="muscle-btn" onclick="filterByMuscle('Chest')" style="padding: 8px 16px; background: #334155; color: #cbd5e1; border: 1px solid #374151; border-radius: 20px; font-size: 14px; cursor: pointer; white-space: nowrap;">Chest</button>
                            <button class="muscle-btn" onclick="filterByMuscle('Back')" style="padding: 8px 16px; background: #334155; color: #cbd5e1; border: 1px solid #374151; border-radius: 20px; font-size: 14px; cursor: pointer; white-space: nowrap;">Back</button>
                            <button class="muscle-btn" onclick="filterByMuscle('Legs')" style="padding: 8px 16px; background: #334155; color: #cbd5e1; border: 1px solid #374151; border-radius: 20px; font-size: 14px; cursor: pointer; white-space: nowrap;">Legs</button>
                            <button class="muscle-btn" onclick="filterByMuscle('Shoulders')" style="padding: 8px 16px; background: #334155; color: #cbd5e1; border: 1px solid #374151; border-radius: 20px; font-size: 14px; cursor: pointer; white-space: nowrap;">Shoulders</button>
                            <button class="muscle-btn" onclick="filterByMuscle('Arms')" style="padding: 8px 16px; background: #334155; color: #cbd5e1; border: 1px solid #374151; border-radius: 20px; font-size: 14px; cursor: pointer; white-space: nowrap;">Arms</button>
                        </div>

                        <div id="exerciseList" class="exercise-list"></div>
                    </div>
                </div>
            </div>

            <!-- History Tab -->
            <div id="historyTab" class="tab-content">
                <div class="history-container">
                    <h2>Workout History</h2>
                    <div id="historyList" class="history-list">
                        <div class="empty-state" style="text-align: center; padding: 60px 20px;">
                            <div class="empty-icon" style="font-size: 48px; margin-bottom: 16px; opacity: 0.5;">üìñ</div>
                            <h3 style="margin-bottom: 8px;">No Workouts Yet</h3>
                            <p style="color: #94a3b8; max-width: 300px; margin: 0 auto;">Complete your first workout to see your training history and progress over time.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analyticsTab" class="tab-content">
                <div class="analytics-container">
                    <h2>Progress Analytics</h2>
                    <div id="analyticsContent" class="analytics-content">
                        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 32px;">
                            <div class="stat-card" style="background: #2a2c2f; border: 1px solid #374151; border-radius: 12px; padding: 20px; text-align: center;">
                                <div class="stat-value" id="totalWorkouts" style="font-size: 32px; font-weight: 800; color: #3d7070; margin-bottom: 8px;">0</div>
                                <div class="stat-label" style="font-size: 14px; color: #94a3b8;">Total Workouts</div>
                            </div>
                            <div class="stat-card" style="background: #2a2c2f; border: 1px solid #374151; border-radius: 12px; padding: 20px; text-align: center;">
                                <div class="stat-value" id="totalSets" style="font-size: 32px; font-weight: 800; color: #3d7070; margin-bottom: 8px;">0</div>
                                <div class="stat-label" style="font-size: 14px; color: #94a3b8;">Total Sets</div>
                            </div>
                            <div class="stat-card" style="background: #2a2c2f; border: 1px solid #374151; border-radius: 12px; padding: 20px; text-align: center;">
                                <div class="stat-value" id="totalVolume" style="font-size: 32px; font-weight: 800; color: #3d7070; margin-bottom: 8px;">0</div>
                                <div class="stat-label" style="font-size: 14px; color: #94a3b8;">Total Volume (lbs)</div>
                            </div>
                            <div class="stat-card" style="background: #2a2c2f; border: 1px solid #374151; border-radius: 12px; padding: 20px; text-align: center;">
                                <div class="stat-value" id="avgDuration" style="font-size: 32px; font-weight: 800; color: #3d7070; margin-bottom: 8px;">0</div>
                                <div class="stat-label" style="font-size: 14px; color: #94a3b8;">Avg Duration (min)</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content">
                <div class="settings-container">
                    <h2>Settings</h2>
                    
                    <div class="settings-section" style="margin-bottom: 32px;">
                        <h3 style="margin-bottom: 16px; font-size: 18px;">Preferences</h3>
                        <div class="setting-item" style="margin-bottom: 16px;">
                            <label class="setting-label" style="display: flex; align-items: center; gap: 12px; cursor: pointer; font-weight: 500;">
                                <input type="checkbox" id="showResearchFacts" checked onchange="toggleResearchFacts(this.checked)" style="width: 20px; height: 20px;">
                                Show Research Facts
                            </label>
                        </div>
                        <div class="setting-item" style="margin-bottom: 16px;">
                            <label class="setting-label" style="display: flex; align-items: center; gap: 12px; cursor: pointer; font-weight: 500;">
                                <input type="checkbox" id="darkMode" checked onchange="toggleDarkMode(this.checked)" style="width: 20px; height: 20px;">
                                Dark Mode
                            </label>
                        </div>
                    </div>

                    <div class="settings-section">
                        <h3 style="margin-bottom: 16px; font-size: 18px;">Data Management</h3>
                        <button class="btn btn-secondary" onclick="exportData()" style="background: #334155; margin-right: 8px; margin-bottom: 8px;">Export Data</button>
                        <button class="btn btn-secondary" onclick="importData()" style="background: #334155; margin-right: 8px; margin-bottom: 8px;">Import Data</button>
                        <button class="btn btn-danger" onclick="clearAllData()" style="background: #ef4444; margin-bottom: 8px;">Clear All Data</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-btn active" onclick="switchTab('workout')" data-tab="workout">
                <div class="nav-icon">üí™</div>
                <div class="nav-label">Workout</div>
            </button>
            <button class="nav-btn" onclick="switchTab('history')" data-tab="history">
                <div class="nav-icon">üìñ</div>
                <div class="nav-label">History</div>
            </button>
            <button class="nav-btn" onclick="switchTab('analytics')" data-tab="analytics">
                <div class="nav-icon">üìä</div>
                <div class="nav-label">Analytics</div>
            </button>
            <button class="nav-btn" onclick="switchTab('settings')" data-tab="settings">
                <div class="nav-icon">‚öôÔ∏è</div>
                <div class="nav-label">Settings</div>
            </button>
        </nav>

        <!-- Floating Action Button -->
        <button class="fab" id="fab" onclick="toggleWorkout()" aria-label="Start workout" style="position: fixed; bottom: 100px; right: 20px; width: 64px; height: 64px; border-radius: 50%; background: linear-gradient(135deg, #1b4e4e, #2c5f5f); color: white; border: none; font-size: 32px; cursor: pointer; box-shadow: 0 10px 15px rgba(0,0,0,0.4); z-index: 99; display: flex; align-items: center; justify-content: center;">
            <span id="fabIcon">+</span>
        </button>
    </div>

    <!-- Modals -->
    <div id="exerciseModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalExerciseName">Exercise</h3>
                <button class="close-btn" onclick="closeExerciseModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="setInputs" class="set-inputs"></div>
                <button class="btn btn-primary" onclick="addSet()">Add Set</button>
                <button class="btn btn-success" onclick="finishExercise()">Finish Exercise</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="/tyler-data-integration.js?v=2.0.1"></script>
    <script src="/app.js?v=2.0.1"></script>
    <script>
        // Register service worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js?v=2.0.1')
                    .then(registration => console.log('SW registered successfully'))
                    .catch(error => console.log('SW registration failed:', error));
            });
        }
    </script>
</body>
</html>